
import { FlashbotsBundleProvider } from "@flashbots/ethers-provider-bundle";
import { providers, Wallet } from "ethers";

let tx = "0xf9052b0185031346bd478303d565944fd0e4818cb850a722bcaa448e06907e05a80c7380b904c49303038d0000000000000000000000000000000000000000000000000003dde52b9ce25c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000f027d40c80d8f70f77d3884776531f80b21d20e0000000000000000000000004502988e070f96cf3bea50b4811cd5844e13a81b0000000000000000000000000b85b3000bef3e26e01428d1b525a532ea7513b800000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000002c00000000000000000000000000000000000000000000000000000000000000044a9059cbb0000000000000000000000000f027d40c80d8f70f77d3884776531f80b21d20e00000000000000000000000000000000000000000000000002bf69bade6a66980000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a4022c0d9f0000000000000000000000000000000000000000000000189dbbafa58310ebbf00000000000000000000000000000000000000000000000000000000000000000000000000000000000000004502988e070f96cf3bea50b4811cd5844e13a81b000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a4022c0d9f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020b12071e5f80b4eb830000000000000000000000000b85b3000bef3e26e01428d1b525a532ea7513b8000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a4022c0d9f00000000000000000000000000000000000000000000000002de98c177f0400100000000000000000000000000000000000000000000000000000000000000000000000000000000000000004fd0e4818cb850a722bcaa448e06907e05a80c73000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000025a0383435f1cc8d4d6f5a301adadd996ef1ca5a597f999a512f70da4b94cd89d40ca042c74f9774407a435356fa79145d25c04b7a8a00e1c9b1a62ace15e51d14c61c"
let targetBlockNumber = 15773123

async function main() {
  //const signedTransactions = await flashbotsProvider.signBundle(transactionBundle)
  const provider = new providers.JsonRpcProvider({ url: "https://mainnet.infura.io/v3/b21211a97c6e49cb92a084c041f30468"}, 1)
  const authSigner = Wallet.createRandom();
  const flashbotsProvider = await FlashbotsBundleProvider.create(
    provider, // a normal ethers.js provider, to perform gas estimiations and nonce lookups
    authSigner // ethers.js signer wallet, only for signing request payloads, not transactions
  )
  
  console.log("////////////////////////////////////////////////////////")
  console.log("/------------------SIMULATION RESULTS------------------/")
  console.log("////////////////////////////////////////////////////////")
  const simulation = JSON.stringify(await flashbotsProvider.simulate([tx], targetBlockNumber, targetBlockNumber + 1), null, 2) 
  console.log(simulation)
  
  console.log("////////////////////////////////////////////////////////")
  console.log("/---------------------BUNDLE STATS---------------------/")
  console.log("////////////////////////////////////////////////////////")
  //console.log(await flashbotsProvider.getBundleStats(JSON.parse(simulation).bundleHash, targetBlockNumber))

  console.log("////////////////////////////////////////////////////////")
  console.log("/------------------CONFLICTING BUNDLE------------------/")
  console.log("////////////////////////////////////////////////////////")
  const conflict = await flashbotsProvider.getConflictingBundle([tx], targetBlockNumber)
  console.log(conflict)
  console.log('\n Stringify \n')
  console.log(JSON.stringify(conflict, null, 2))


}

main()
